<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Scan2Print</title>

<style>
:root{
  --blue:#2563eb;
  --green:#16a34a;
  --bg:#f1f5f9;
  --text:#0f172a;
  --muted:#64748b;
}

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  margin:0; padding:20px;
  display:flex; justify-content:center; align-items:center;
  min-height:95vh; color:var(--text);
}

.card{
  background:#fff;
  width:100%; max-width:420px;
  padding:28px;
  border-radius:20px;
  box-shadow:0 10px 25px -5px rgba(0,0,0,.1);
  text-align:center;
}

.title{font-size:24px;font-weight:800;margin-bottom:4px}
.subtitle{font-size:13px;color:var(--muted);margin-bottom:18px}

.hint{
  background:#eff6ff;
  color:#1e40af;
  font-size:13px;
  padding:10px 12px;
  border-radius:12px;
  text-align:left;
  margin-bottom:20px;
}

/* UPLOAD BOXES */
.upload-box{
  border:2px dashed;
  border-radius:16px;
  padding:28px 18px;
  margin-bottom:14px;
  cursor:pointer;
  position:relative;
  transition:.2s;
}

.upload-box input{
  position:absolute;
  inset:0;
  opacity:0;
  cursor:pointer;
}

.upload-box .icon{
  font-size:34px;
  margin-bottom:6px;
}

.upload-box .label{
  font-size:15px;
  font-weight:700;
}

/* PDF */
.pdf-box{
  border-color:var(--blue);
  background:#eff6ff;
}
.pdf-box .label{color:var(--blue)}

/* IMAGE / OTHER */
.other-box{
  border-color:var(--green);
  background:#ecfdf5;
}
.other-box .label{color:var(--green)}

.file-info{
  display:none;
  margin-top:14px;
  background:#f1f5f9;
  padding:10px;
  border-radius:10px;
  text-align:left;
  font-size:13px;
}
.file-info.visible{display:flex;justify-content:space-between;gap:10px}
.f-name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.f-size{color:var(--muted)}

.upload-btn{
  width:100%;
  margin-top:18px;
  padding:15px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:800;
  color:#fff;
  opacity:.5;
  pointer-events:none;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}

.upload-btn.active{
  opacity:1;
  pointer-events:auto;
}

.spinner{
  width:18px;height:18px;
  border:3px solid rgba(255,255,255,.3);
  border-top-color:#fff;
  border-radius:50%;
  animation:spin .8s linear infinite;
  display:none;
}

@keyframes spin{to{transform:rotate(360deg)}}

.hidden{display:none!important}
.success-view{padding:40px 0}
.check{font-size:64px;margin-bottom:14px}

.error{
  margin-top:14px;
  background:#fef2f2;
  color:#b91c1c;
  padding:10px;
  border-radius:10px;
  font-size:13px;
}
</style>
</head>

<body>

<div class="card" id="app">
  <div style="color:#94a3b8;padding:40px">Verifying shop‚Ä¶</div>
</div>

<script>
/* ------------ CONFIG ------------ */
const CLIENT_CONFIG={
  shop1:{
    name:"Downtown Print Shop",
    url:"YOUR_APPS_SCRIPT_URL"
  }
};

/* ------------ ROUTER ------------ */
const params=new URLSearchParams(location.search);
const clientId=params.get("client");
const app=document.getElementById("app");

if(!clientId||!CLIENT_CONFIG[clientId]){
  app.innerHTML="<div class='title' style='color:red'>Invalid QR</div>";
  throw "";
}
const SHOP=CLIENT_CONFIG[clientId];

/* ------------ UI ------------ */
app.innerHTML=`
<div id="formView">
  <div class="title">${SHOP.name}</div>
  <div class="subtitle">Powered by Scan2Print</div>

  <div class="hint">
    üì§ <b>Uploading from WhatsApp?</b><br>
    ‚Ä¢ PDFs ‚Üí Documents ‚Üí WhatsApp<br>
    ‚Ä¢ Images ‚Üí Images ‚Üí WhatsApp
  </div>

  <div class="upload-box pdf-box">
    <div class="icon">üìÑ</div>
    <div class="label">Upload PDF (Printing)</div>
    <input type="file" id="pdfInput" accept=".pdf,application/pdf">
  </div>

  <div class="upload-box other-box">
    <div class="icon">üñºÔ∏è</div>
    <div class="label">Upload Images / Other Files</div>
    <input type="file" id="otherInput"
      accept="image/*,.doc,.docx,.zip,.rar,.ppt,.pptx,.txt">
  </div>

  <div class="file-info" id="fileInfo">
    <span class="f-name" id="fName"></span>
    <span class="f-size" id="fSize"></span>
  </div>

  <button id="uploadBtn" class="upload-btn">
    <span class="spinner" id="spinner"></span>
    <span id="btnText">Send to Shop</span>
  </button>

  <div id="error" class="error hidden"></div>
</div>

<div id="successView" class="success-view hidden">
  <div class="check">‚úÖ</div>
  <div class="title">Sent!</div>
  <div class="subtitle">Please inform the shopkeeper</div>
  <button class="upload-btn active"
    style="background:#e5e7eb;color:#111"
    onclick="location.reload()">Send Another</button>
</div>
`;

/* ------------ LOGIC ------------ */
let selectedFile=null;
let selectedColor=null;

const pdfInput=document.getElementById("pdfInput");
const otherInput=document.getElementById("otherInput");
const fileInfo=document.getElementById("fileInfo");
const uploadBtn=document.getElementById("uploadBtn");
const spinner=document.getElementById("spinner");
const btnText=document.getElementById("btnText");
const error=document.getElementById("error");

pdfInput.onchange=()=>handleFile(pdfInput.files[0],"blue");
otherInput.onchange=()=>handleFile(otherInput.files[0],"green");

function handleFile(file,color){
  if(!file)return;
  selectedFile=file;
  selectedColor=color;

  document.getElementById("fName").innerText=file.name;
  document.getElementById("fSize").innerText=
    (file.size/1048576).toFixed(1)+" MB";

  fileInfo.classList.add("visible");
  uploadBtn.classList.add("active");
  uploadBtn.style.background =
    color==="blue"?"var(--blue)":"var(--green)";
  error.classList.add("hidden");
}

uploadBtn.onclick=()=>{
  if(!selectedFile)return;

  uploadBtn.classList.remove("active");
  spinner.style.display="block";
  btnText.innerText="Sending‚Ä¶";

  const reader=new FileReader();
  reader.onload=e=>{
    fetch(SHOP.url,{
      method:"POST",
      mode:"no-cors",
      body:JSON.stringify({
        shop:SHOP.name,
        fileName:selectedFile.name,
        mimeType:selectedFile.type,
        fileData:e.target.result.split(",")[1]
      })
    }).then(()=>{
      formView.classList.add("hidden");
      successView.classList.remove("hidden");
    });
  };
  reader.readAsDataURL(selectedFile);
};
</script>

</body>
</html>
